<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Создать разделы</title>
    <link rel="stylesheet" href="css/style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Проверка авторизации -->
    <script>
        if (!localStorage.getItem('currentUser')) {
            window.location.href = 'index.html';
        }
        // Применяем тему сразу
        const settings = JSON.parse(localStorage.getItem('settings') || '{}');
        if (settings.darkTheme) {
            document.body.classList.add('dark-theme');
        }
    </script>

    <!-- Шапка -->
    <header class="header">
        <a href="add-members.html" class="icon-btn">
            <i class="fas fa-arrow-left"></i>
        </a>

        <div class="header-title">
            <h1>Создать разделы проекта</h1>
        </div>

        <div class="header-actions"></div>
    </header>

    <!-- Основное содержимое -->
    <main class="container create-sections">
        <div id="sectionsContainer">
            <!-- Разделы будут добавляться здесь -->
            <div class="section-item">
                <div class="section-number">раздел 1</div>
                <input type="text"
                       class="section-input"
                       value="анализ"
                       placeholder="Название раздела">
            </div>

            <div class="section-item">
                <div class="section-number">раздел 2</div>
                <input type="text"
                       class="section-input"
                       value="разработка"
                       placeholder="Название раздела">
            </div>

            <div class="section-item">
                <div class="section-number">раздел 3</div>
                <input type="text"
                       class="section-input"
                       value="тестирование"
                       placeholder="Название раздела">
            </div>
        </div>

        <button type="button" class="btn btn-outline add-section-btn" onclick="addSection()">
            <i class="fas fa-plus"></i> добавить раздел
        </button>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                Назад
            </button>
            <button type="button" class="btn btn-primary" onclick="saveSections()">
                Далее: Создать задачи
            </button>
        </div>
    </main>

    <script>
        // Загружаем проект.
        let tempProject = JSON.parse(sessionStorage.getItem('tempProject') || '{}');

        // Инициализируем массив разделов, если его нет
        if (!tempProject.sections) {
            // Если разделов вообще нет, даем 3 пустых по умолчанию для удобства
            tempProject.sections = ['анализ', 'разработка', 'тестирование'];
        }

        document.addEventListener('DOMContentLoaded', function() {
            renderSections();
        });

        function renderSections() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = '';

            tempProject.sections.forEach((sectionName, index) => {
                const sectionItem = document.createElement('div');
                sectionItem.className = 'section-item';
                sectionItem.innerHTML = `
                    <div class="section-number">раздел ${index + 1}</div>
                    <input type="text" class="section-input" value="${sectionName}" placeholder="Название раздела">
                    <button class="remove-section" onclick="removeSection(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(sectionItem);
            });
        }

        function saveCurrentInputs() {
            // Считываем то, что сейчас написано в полях, в массив
            const inputs = document.querySelectorAll('.section-input');
            tempProject.sections = Array.from(inputs).map(input => input.value.trim()).filter(val => val !== "");
        }

        function addSection() {
            saveCurrentInputs(); // Сохраняем текущий текст перед перерисовкой
            tempProject.sections.push(''); // Добавляем пустой
            renderSections();
        }

        function removeSection(index) {
            saveCurrentInputs();
            if (tempProject.sections.length <= 1) {
                alert("Оставьте хотя бы один раздел");
                return;
            }
            tempProject.sections.splice(index, 1);
            renderSections();
        }

        function saveSections() {
            saveCurrentInputs();

            if (tempProject.sections.length === 0) {
                alert('Добавьте хотя бы один раздел');
                return;
            }

            // Сохраняем в память
            sessionStorage.setItem('tempProject', JSON.stringify(tempProject));
            window.location.href = 'create-tasks.html';
        }
    </script>
</body>
</html>
